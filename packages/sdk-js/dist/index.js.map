{"version":3,"sources":["../src/errors.ts","../src/validation.ts","../src/client.ts"],"names":[],"mappings":"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","file":"index.js","sourcesContent":["/**\n * Error types for EtherPly SDK.\n * \n * Using typed errors allows consumers to handle specific failure modes.\n */\n\n/**\n * Base class for all EtherPly errors.\n */\nexport class EtherPlyError extends Error {\n    constructor(message: string, public readonly code: string) {\n        super(message);\n        this.name = 'EtherPlyError';\n        // Maintains proper stack trace for where error was thrown (V8 only)\n        if (Error.captureStackTrace) {\n            Error.captureStackTrace(this, EtherPlyError);\n        }\n    }\n}\n\n/**\n * Thrown when configuration is invalid.\n */\nexport class ConfigurationError extends EtherPlyError {\n    constructor(message: string) {\n        super(message, 'CONFIGURATION_ERROR');\n        this.name = 'ConfigurationError';\n    }\n}\n\n/**\n * Thrown when connection fails or times out.\n */\nexport class ConnectionError extends EtherPlyError {\n    constructor(\n        message: string,\n        public readonly cause?: Error,\n        public readonly isRetryable: boolean = true\n    ) {\n        super(message, 'CONNECTION_ERROR');\n        this.name = 'ConnectionError';\n    }\n}\n\n/**\n * Thrown when authentication fails.\n */\nexport class AuthenticationError extends EtherPlyError {\n    constructor(message: string = 'Authentication failed') {\n        super(message, 'AUTHENTICATION_ERROR');\n        this.name = 'AuthenticationError';\n    }\n}\n\n/**\n * Thrown when a message fails to parse or validate.\n */\nexport class MessageError extends EtherPlyError {\n    constructor(\n        message: string,\n        public readonly rawMessage?: string\n    ) {\n        super(message, 'MESSAGE_ERROR');\n        this.name = 'MessageError';\n    }\n}\n\n/**\n * Thrown when the operation queue exceeds capacity.\n */\nexport class QueueOverflowError extends EtherPlyError {\n    constructor(maxSize: number) {\n        super(\n            `Operation queue exceeded maximum capacity of ${maxSize}. ` +\n            'Consider increasing maxQueueSize or reducing send frequency.',\n            'QUEUE_OVERFLOW_ERROR'\n        );\n        this.name = 'QueueOverflowError';\n    }\n}\n","/**\n * Message validation utilities.\n * \n * Defensive parsing to ensure messages from the server are well-formed\n * before processing. This prevents runtime errors from malformed data.\n */\n\nimport type {\n    EtherPlyMessage,\n    InitMessage,\n    OperationMessage,\n    PresenceMessage,\n    PresenceUser,\n} from './types';\nimport { MessageError } from './errors';\n\n/**\n * Type guard for InitMessage.\n */\nfunction isInitMessage(data: unknown): data is InitMessage {\n    if (typeof data !== 'object' || data === null) return false;\n    const obj = data as Record<string, unknown>;\n    return (\n        obj.type === 'init' &&\n        typeof obj.data === 'object' &&\n        obj.data !== null\n    );\n}\n\n/**\n * Type guard for OperationMessage.\n */\nfunction isOperationMessage(data: unknown): data is OperationMessage {\n    if (typeof data !== 'object' || data === null) return false;\n    const obj = data as Record<string, unknown>;\n    if (obj.type !== 'op') return false;\n\n    const payload = obj.payload;\n    if (typeof payload !== 'object' || payload === null) return false;\n\n    const p = payload as Record<string, unknown>;\n    return (\n        typeof p.key === 'string' &&\n        p.key.length > 0 &&\n        'value' in p &&\n        typeof p.timestamp === 'number'\n    );\n}\n\n/**\n * Type guard for PresenceUser.\n */\nfunction isPresenceUser(data: unknown): data is PresenceUser {\n    if (typeof data !== 'object' || data === null) return false;\n    const obj = data as Record<string, unknown>;\n    return (\n        typeof obj.userId === 'string' &&\n        (obj.status === 'online' || obj.status === 'idle')\n    );\n}\n\n/**\n * Type guard for PresenceMessage.\n */\nfunction isPresenceMessage(data: unknown): data is PresenceMessage {\n    if (typeof data !== 'object' || data === null) return false;\n    const obj = data as Record<string, unknown>;\n    if (obj.type !== 'presence') return false;\n\n    const users = obj.users;\n    if (!Array.isArray(users)) return false;\n\n    return users.every(isPresenceUser);\n}\n\n/**\n * Parses and validates a raw message string from the server.\n * \n * @param raw - Raw JSON string from WebSocket\n * @returns Validated EtherPlyMessage\n * @throws {MessageError} If message is invalid\n * \n * @example\n * ```typescript\n * try {\n *   const message = parseMessage(event.data);\n *   // message is now type-safe\n * } catch (error) {\n *   if (error instanceof MessageError) {\n *     console.error('Invalid message:', error.rawMessage);\n *   }\n * }\n * ```\n */\nexport function parseMessage(raw: string): EtherPlyMessage {\n    // Step 1: Parse JSON\n    let data: unknown;\n    try {\n        data = JSON.parse(raw);\n    } catch (error) {\n        throw new MessageError(\n            `Failed to parse message as JSON: ${error instanceof Error ? error.message : 'Unknown error'}`,\n            raw\n        );\n    }\n\n    // Step 2: Validate structure\n    if (typeof data !== 'object' || data === null) {\n        throw new MessageError('Message must be an object', raw);\n    }\n\n    const obj = data as Record<string, unknown>;\n    if (typeof obj.type !== 'string') {\n        throw new MessageError('Message must have a \"type\" field', raw);\n    }\n\n    // Step 3: Validate specific message types\n    if (isInitMessage(data)) {\n        return data;\n    }\n\n    if (isOperationMessage(data)) {\n        return data;\n    }\n\n    if (isPresenceMessage(data)) {\n        return data;\n    }\n\n    throw new MessageError(\n        `Unknown or malformed message type: \"${obj.type}\"`,\n        raw\n    );\n}\n\n/**\n * Safely truncates a string for logging/error messages.\n * Prevents log explosion from large payloads.\n */\nexport function truncate(str: string, maxLength: number = 200): string {\n    if (str.length <= maxLength) return str;\n    return str.substring(0, maxLength) + `... (${str.length - maxLength} more chars)`;\n}\n","import type {\n    EtherPlyConfig,\n    ConnectionStatus,\n    MessageHandler,\n    StatusHandler,\n} from './types';\nimport {\n    ConfigurationError,\n    ConnectionError,\n} from './errors';\nimport { parseMessage, truncate } from './validation';\n\n/**\n * Internal resolved configuration with all defaults applied.\n */\ninterface ResolvedConfig {\n    workspaceId: string;\n    token: string;\n    userId: string;\n    serverUrl: string;\n    autoReconnect: boolean;\n    maxReconnectAttempts: number;\n    reconnectBaseDelay: number;\n    maxReconnectDelay: number;\n    connectionTimeout: number;\n    heartbeatInterval: number;\n    maxQueueSize: number;\n    debug: boolean;\n}\n\n/**\n * Default configuration values.\n */\nconst DEFAULT_CONFIG: Omit<ResolvedConfig, 'workspaceId' | 'token' | 'userId'> = {\n    serverUrl: 'wss://api.etherply.com',\n    autoReconnect: true,\n    maxReconnectAttempts: 10,\n    reconnectBaseDelay: 1000,\n    maxReconnectDelay: 30000,\n    connectionTimeout: 10000,\n    heartbeatInterval: 30000,\n    maxQueueSize: 1000,\n    debug: false,\n};\n\n/**\n * Queued operation structure.\n */\ninterface QueuedOperation {\n    key: string;\n    value: unknown;\n    timestamp: number;\n}\n\n/**\n * EtherPly client for real-time synchronization.\n *\n * The client manages a WebSocket connection to an EtherPly server,\n * handles automatic reconnection, and provides methods for sending\n * and receiving state updates.\n *\n * ## Features\n * - Automatic reconnection with exponential backoff\n * - Connection timeout to prevent hangs\n * - Heartbeat pings to detect dead connections\n * - Operation queueing when offline\n * - Bounded queue to prevent memory issues\n * - Defensive message parsing\n *\n * @example Basic Usage\n * ```typescript\n * const client = new EtherPlyClient({\n *   workspaceId: 'my-workspace',\n *   token: 'jwt-token'\n * });\n *\n * await client.connect();\n *\n * client.onMessage((msg) => {\n *   if (msg.type === 'op') {\n *     console.log('Update:', msg.payload.key, '=', msg.payload.value);\n *   }\n * });\n *\n * client.set('greeting', 'Hello!');\n * ```\n */\nexport class EtherPlyClient {\n    private readonly config: ResolvedConfig;\n    private ws: WebSocket | null = null;\n    private status: ConnectionStatus = 'IDLE';\n    private readonly messageListeners = new Set<MessageHandler>();\n    private readonly statusListeners = new Set<StatusHandler>();\n    private reconnectAttempts = 0;\n    private reconnectTimeout: ReturnType<typeof setTimeout> | null = null;\n    private connectionTimeout: ReturnType<typeof setTimeout> | null = null;\n    private heartbeatInterval: ReturnType<typeof setInterval> | null = null;\n    private operationQueue: QueuedOperation[] = [];\n    private currentState: Record<string, unknown> = {};\n    private isDestroyed = false;\n\n    /**\n     * Creates a new EtherPly client instance.\n     *\n     * @param config - Configuration options\n     * @throws {ConfigurationError} If workspaceId or token is missing\n     */\n    constructor(config: EtherPlyConfig) {\n        // Validate required fields\n        if (!config.workspaceId || typeof config.workspaceId !== 'string') {\n            throw new ConfigurationError('EtherPly: workspaceId is required and must be a non-empty string');\n        }\n        if (!config.token || typeof config.token !== 'string') {\n            throw new ConfigurationError('EtherPly: token is required and must be a non-empty string');\n        }\n\n        // Validate optional fields\n        if (config.serverUrl !== undefined && typeof config.serverUrl !== 'string') {\n            throw new ConfigurationError('EtherPly: serverUrl must be a string');\n        }\n        if (config.maxReconnectAttempts !== undefined &&\n            (typeof config.maxReconnectAttempts !== 'number' || config.maxReconnectAttempts < 0)) {\n            throw new ConfigurationError('EtherPly: maxReconnectAttempts must be a non-negative number');\n        }\n        if (config.connectionTimeout !== undefined &&\n            (typeof config.connectionTimeout !== 'number' || config.connectionTimeout < 0)) {\n            throw new ConfigurationError('EtherPly: connectionTimeout must be a non-negative number');\n        }\n        if (config.maxQueueSize !== undefined &&\n            (typeof config.maxQueueSize !== 'number' || config.maxQueueSize < 0)) {\n            throw new ConfigurationError('EtherPly: maxQueueSize must be a non-negative number');\n        }\n\n        this.config = {\n            ...DEFAULT_CONFIG,\n            workspaceId: config.workspaceId.trim(),\n            token: config.token,\n            userId: config.userId?.trim() || this.generateUserId(),\n            ...(config.serverUrl && { serverUrl: config.serverUrl }),\n            ...(config.autoReconnect !== undefined && { autoReconnect: config.autoReconnect }),\n            ...(config.maxReconnectAttempts !== undefined && { maxReconnectAttempts: config.maxReconnectAttempts }),\n            ...(config.reconnectBaseDelay !== undefined && { reconnectBaseDelay: config.reconnectBaseDelay }),\n            ...(config.maxReconnectDelay !== undefined && { maxReconnectDelay: config.maxReconnectDelay }),\n            ...(config.connectionTimeout !== undefined && { connectionTimeout: config.connectionTimeout }),\n            ...(config.heartbeatInterval !== undefined && { heartbeatInterval: config.heartbeatInterval }),\n            ...(config.maxQueueSize !== undefined && { maxQueueSize: config.maxQueueSize }),\n            ...(config.debug !== undefined && { debug: config.debug }),\n        };\n    }\n\n    /**\n     * Generates a random user ID using crypto if available, falling back to Math.random.\n     */\n    private generateUserId(): string {\n        // Try crypto API first (more random)\n        if (typeof crypto !== 'undefined' && crypto.randomUUID) {\n            return `user-${crypto.randomUUID().substring(0, 8)}`;\n        }\n        // Fallback to Math.random\n        return 'user-' + Math.random().toString(36).substring(2, 11);\n    }\n\n    /**\n     * Logs a debug message if debug mode is enabled.\n     */\n    private log(message: string, ...args: unknown[]): void {\n        if (this.config.debug) {\n            const timestamp = new Date().toISOString();\n            console.log(`[EtherPly ${timestamp}] ${message}`, ...args);\n        }\n    }\n\n    /**\n     * Logs a warning message (always shown).\n     */\n    private warn(message: string, ...args: unknown[]): void {\n        console.warn(`[EtherPly] ${message}`, ...args);\n    }\n\n    /**\n     * Updates the connection status and notifies listeners.\n     */\n    private setStatus(newStatus: ConnectionStatus): void {\n        if (this.status !== newStatus) {\n            this.log(`Status: ${this.status} -> ${newStatus}`);\n            this.status = newStatus;\n\n            // Clone listeners to avoid mutation during iteration\n            const listeners = Array.from(this.statusListeners);\n            for (const listener of listeners) {\n                try {\n                    listener(newStatus);\n                } catch (error) {\n                    this.warn('Status listener threw an error:', error);\n                }\n            }\n        }\n    }\n\n    /**\n     * Builds the WebSocket URL with query parameters.\n     */\n    private buildUrl(): string {\n        const base = this.config.serverUrl.replace(/\\/+$/, '');\n        const params = new URLSearchParams({\n            token: this.config.token,\n            userId: this.config.userId,\n        });\n        // Encode workspaceId to handle special characters\n        const encodedWorkspace = encodeURIComponent(this.config.workspaceId);\n        return `${base}/v1/sync/${encodedWorkspace}?${params.toString()}`;\n    }\n\n    /**\n     * Connects to the EtherPly server.\n     *\n     * @returns A promise that resolves when connected, or rejects on error.\n     * @throws {ConnectionError} If connection fails or times out\n     */\n    connect(): Promise<void> {\n        if (this.isDestroyed) {\n            return Promise.reject(new ConnectionError('Client has been destroyed', undefined, false));\n        }\n\n        if (this.status === 'CONNECTED') {\n            this.log('Already connected');\n            return Promise.resolve();\n        }\n\n        if (this.status === 'CONNECTING') {\n            this.log('Connection already in progress');\n            return Promise.resolve();\n        }\n\n        return new Promise((resolve, reject) => {\n            this.setStatus('CONNECTING');\n            const url = this.buildUrl();\n            this.log('Connecting to', url.replace(this.config.token, '[REDACTED]'));\n\n            // Set connection timeout\n            if (this.config.connectionTimeout > 0) {\n                this.connectionTimeout = setTimeout(() => {\n                    this.log('Connection timeout');\n                    this.cleanupConnection();\n                    this.setStatus('ERROR');\n                    reject(new ConnectionError(\n                        `Connection timed out after ${this.config.connectionTimeout}ms`,\n                        undefined,\n                        true\n                    ));\n                }, this.config.connectionTimeout);\n            }\n\n            try {\n                this.ws = new WebSocket(url);\n            } catch (error) {\n                this.clearConnectionTimeout();\n                this.setStatus('ERROR');\n                reject(new ConnectionError(\n                    'Failed to create WebSocket',\n                    error instanceof Error ? error : undefined,\n                    false\n                ));\n                return;\n            }\n\n            this.ws.onopen = () => {\n                this.clearConnectionTimeout();\n                this.log('WebSocket connected');\n                this.setStatus('CONNECTED');\n                this.reconnectAttempts = 0;\n                this.startHeartbeat();\n                this.flushOperationQueue();\n                resolve();\n            };\n\n            this.ws.onclose = (event) => {\n                this.clearConnectionTimeout();\n                this.log('WebSocket closed', { code: event.code, reason: event.reason });\n                this.handleDisconnect(event.code);\n            };\n\n            this.ws.onerror = () => {\n                this.log('WebSocket error');\n                if (this.status === 'CONNECTING') {\n                    this.clearConnectionTimeout();\n                    this.setStatus('ERROR');\n                    reject(new ConnectionError('WebSocket connection failed', undefined, true));\n                }\n            };\n\n            this.ws.onmessage = (event) => {\n                this.handleMessage(event.data);\n            };\n        });\n    }\n\n    /**\n     * Clears the connection timeout timer.\n     */\n    private clearConnectionTimeout(): void {\n        if (this.connectionTimeout) {\n            clearTimeout(this.connectionTimeout);\n            this.connectionTimeout = null;\n        }\n    }\n\n    /**\n     * Starts the heartbeat interval to detect dead connections.\n     */\n    private startHeartbeat(): void {\n        this.stopHeartbeat();\n\n        if (this.config.heartbeatInterval <= 0) {\n            return;\n        }\n\n        this.heartbeatInterval = setInterval(() => {\n            if (this.ws?.readyState === WebSocket.OPEN) {\n                try {\n                    // Send a ping message\n                    // Note: Browser WebSocket doesn't expose ping(), so we send a custom message\n                    this.ws.send(JSON.stringify({ type: 'ping', timestamp: Date.now() }));\n                    this.log('Heartbeat sent');\n                } catch (error) {\n                    this.warn('Failed to send heartbeat:', error);\n                }\n            }\n        }, this.config.heartbeatInterval);\n    }\n\n    /**\n     * Stops the heartbeat interval.\n     */\n    private stopHeartbeat(): void {\n        if (this.heartbeatInterval) {\n            clearInterval(this.heartbeatInterval);\n            this.heartbeatInterval = null;\n        }\n    }\n\n    /**\n     * Handles incoming messages from the server.\n     */\n    private handleMessage(data: string): void {\n        try {\n            const message = parseMessage(data);\n            this.log('Received:', message.type);\n\n            // Update local state cache\n            if (message.type === 'init') {\n                this.currentState = { ...message.data };\n            } else if (message.type === 'op') {\n                this.currentState[message.payload.key] = message.payload.value;\n            }\n            // Ignore pong messages (heartbeat responses)\n\n            // Notify listeners\n            const listeners = Array.from(this.messageListeners);\n            for (const listener of listeners) {\n                try {\n                    listener(message);\n                } catch (error) {\n                    this.warn('Message listener threw an error:', error);\n                }\n            }\n        } catch (error) {\n            // Log but don't crash on malformed messages\n            this.warn('Failed to parse message:', truncate(data), error);\n        }\n    }\n\n    /**\n     * Handles disconnection and initiates reconnection if configured.\n     */\n    private handleDisconnect(closeCode?: number): void {\n        this.cleanupConnection();\n\n        // Check for authentication errors (typically 4001 or 4003)\n        if (closeCode && closeCode >= 4000 && closeCode < 4100) {\n            this.warn('Authentication error, not reconnecting');\n            this.setStatus('ERROR');\n            return;\n        }\n\n        if (!this.config.autoReconnect) {\n            this.setStatus('DISCONNECTED');\n            return;\n        }\n\n        if (this.reconnectAttempts >= this.config.maxReconnectAttempts) {\n            this.log('Max reconnect attempts reached');\n            this.setStatus('ERROR');\n            return;\n        }\n\n        this.setStatus('RECONNECTING');\n        this.scheduleReconnect();\n    }\n\n    /**\n     * Cleans up the current connection without changing status.\n     */\n    private cleanupConnection(): void {\n        this.stopHeartbeat();\n        this.clearConnectionTimeout();\n\n        if (this.ws) {\n            // Remove handlers to prevent callbacks during cleanup\n            this.ws.onopen = null;\n            this.ws.onclose = null;\n            this.ws.onerror = null;\n            this.ws.onmessage = null;\n\n            try {\n                this.ws.close();\n            } catch {\n                // Ignore errors during cleanup\n            }\n            this.ws = null;\n        }\n    }\n\n    /**\n     * Schedules a reconnection attempt with capped exponential backoff.\n     */\n    private scheduleReconnect(): void {\n        // Calculate delay with exponential backoff, capped at maxReconnectDelay\n        const rawDelay = this.config.reconnectBaseDelay * Math.pow(2, this.reconnectAttempts);\n        const delay = Math.min(rawDelay, this.config.maxReconnectDelay);\n\n        // Add jitter (Â±10%) to prevent thundering herd\n        const jitter = delay * 0.1 * (Math.random() * 2 - 1);\n        const finalDelay = Math.round(delay + jitter);\n\n        this.log(`Reconnecting in ${finalDelay}ms (attempt ${this.reconnectAttempts + 1}/${this.config.maxReconnectAttempts})`);\n\n        this.reconnectTimeout = setTimeout(() => {\n            this.reconnectAttempts++;\n            this.connect().catch((error) => {\n                this.log('Reconnect failed:', error);\n                // handleDisconnect will be called by the WebSocket close event\n            });\n        }, finalDelay);\n    }\n\n    /**\n     * Flushes any operations queued while disconnected.\n     */\n    private flushOperationQueue(): void {\n        if (this.operationQueue.length === 0) {\n            return;\n        }\n\n        this.log(`Flushing ${this.operationQueue.length} queued operations`);\n\n        // Process queue in order (FIFO)\n        while (this.operationQueue.length > 0) {\n            const op = this.operationQueue.shift()!;\n            this.sendOperationInternal(op.key, op.value, op.timestamp);\n        }\n    }\n\n    /**\n     * Sets a key-value pair in the workspace.\n     *\n     * @param key - The key to set (must be non-empty string)\n     * @param value - The value to set\n     * @throws {ConfigurationError} If key is invalid\n     */\n    set(key: string, value: unknown): void {\n        if (!key || typeof key !== 'string') {\n            throw new ConfigurationError('Key must be a non-empty string');\n        }\n        this.sendOperation(key, value);\n    }\n\n    /**\n     * Gets the current value of a key from local state.\n     *\n     * Note: This returns the locally cached state, which may be\n     * momentarily out of sync with the server.\n     *\n     * @param key - The key to get\n     * @returns The value, or undefined if not found\n     */\n    get<T = unknown>(key: string): T | undefined {\n        return this.currentState[key] as T | undefined;\n    }\n\n    /**\n     * Gets the entire current state of the workspace.\n     *\n     * @returns A shallow copy of the current state\n     */\n    getState(): Record<string, unknown> {\n        return { ...this.currentState };\n    }\n\n    /**\n     * Sends an operation to update a key-value pair.\n     *\n     * If not connected, the operation is queued and sent when reconnected.\n     *\n     * @param key - The key to update\n     * @param value - The new value\n     */\n    sendOperation(key: string, value: unknown): void {\n        const timestamp = Date.now() * 1000; // Unix microseconds\n\n        // Optimistic local update\n        this.currentState[key] = value;\n\n        if (this.ws?.readyState !== WebSocket.OPEN) {\n            this.queueOperation(key, value, timestamp);\n            return;\n        }\n\n        this.sendOperationInternal(key, value, timestamp);\n    }\n\n    /**\n     * Internal method to send an operation (assumes connection is open).\n     */\n    private sendOperationInternal(key: string, value: unknown, timestamp: number): void {\n        if (this.ws?.readyState !== WebSocket.OPEN) {\n            return;\n        }\n\n        const message = JSON.stringify({\n            type: 'op',\n            payload: { key, value, timestamp },\n        });\n\n        try {\n            this.ws.send(message);\n            this.log('Sent operation:', key);\n        } catch (error) {\n            this.warn('Failed to send operation:', error);\n            // Re-queue the operation\n            this.queueOperation(key, value, timestamp);\n        }\n    }\n\n    /**\n     * Queues an operation for later sending.\n     */\n    private queueOperation(key: string, value: unknown, timestamp: number): void {\n        // Check queue size limit\n        if (this.config.maxQueueSize > 0 && this.operationQueue.length >= this.config.maxQueueSize) {\n            // Drop oldest operation (FIFO)\n            const dropped = this.operationQueue.shift();\n            this.warn(`Queue full, dropping oldest operation: ${dropped?.key}`);\n        }\n\n        this.operationQueue.push({ key, value, timestamp });\n        this.log(`Queued operation: ${key} (queue size: ${this.operationQueue.length})`);\n    }\n\n    /**\n     * Subscribes to incoming messages.\n     *\n     * @param handler - Function to call when a message is received\n     * @returns A cleanup function to unsubscribe\n     */\n    onMessage(handler: MessageHandler): () => void {\n        if (typeof handler !== 'function') {\n            throw new ConfigurationError('Message handler must be a function');\n        }\n\n        this.messageListeners.add(handler);\n        return () => {\n            this.messageListeners.delete(handler);\n        };\n    }\n\n    /**\n     * Subscribes to connection status changes.\n     *\n     * The handler is called immediately with the current status.\n     *\n     * @param handler - Function to call when status changes\n     * @returns A cleanup function to unsubscribe\n     */\n    onStatusChange(handler: StatusHandler): () => void {\n        if (typeof handler !== 'function') {\n            throw new ConfigurationError('Status handler must be a function');\n        }\n\n        this.statusListeners.add(handler);\n        // Immediately call with current status\n        try {\n            handler(this.status);\n        } catch (error) {\n            this.warn('Status handler threw an error:', error);\n        }\n        return () => {\n            this.statusListeners.delete(handler);\n        };\n    }\n\n    /**\n     * Gets the current connection status.\n     */\n    getStatus(): ConnectionStatus {\n        return this.status;\n    }\n\n    /**\n     * Gets the number of operations in the queue.\n     */\n    getQueueSize(): number {\n        return this.operationQueue.length;\n    }\n\n    /**\n     * Disconnects from the server.\n     *\n     * After calling this, you can call `connect()` again to reconnect.\n     */\n    disconnect(): void {\n        this.log('Disconnecting');\n\n        // Cancel any pending reconnection\n        if (this.reconnectTimeout) {\n            clearTimeout(this.reconnectTimeout);\n            this.reconnectTimeout = null;\n        }\n\n        this.cleanupConnection();\n        this.setStatus('DISCONNECTED');\n    }\n\n    /**\n     * Alias for disconnect() for API consistency.\n     */\n    close(): void {\n        this.disconnect();\n    }\n\n    /**\n     * Fetches current presence information for the workspace.\n     * \n     * @returns A promise resolving to a list of active users.\n     */\n    async getPresence(): Promise<Array<{ userId: string; status: string; last_seen: string }>> {\n        const url = this.config.serverUrl.replace(/\\/+$/, '') + `/v1/presence/${this.config.workspaceId}`;\n\n        const response = await fetch(url, {\n            headers: {\n                'Authorization': `Bearer ${this.config.token}`\n            }\n        });\n\n        if (!response.ok) {\n            throw new Error(`Failed to fetch presence: ${response.statusText}`);\n        }\n\n        return response.json();\n    }\n\n    /**\n     * Permanently destroys the client, releasing all resources.\n     * \n     * After calling this, the client cannot be reconnected.\n     * Use this for cleanup in React useEffect or similar.\n     */\n    destroy(): void {\n        this.log('Destroying client');\n        this.disconnect();\n        this.messageListeners.clear();\n        this.statusListeners.clear();\n        this.operationQueue = [];\n        this.currentState = {};\n        this.isDestroyed = true;\n    }\n}\n"]}